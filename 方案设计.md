# 🤖 Telegram 媒体合并机器人 - 开发方案

## 📖 1. 项目简介
本项目旨在开发一个 Telegram 机器人，能够接收用户发送的多张**图片**或**视频**，并根据用户的指令将其**合并**为一个单独的文件（长图拼贴或视频拼接）。

---

## 🚀 2. 核心功能

| 功能模块 | 描述 |
| :--- | :--- |
| **基础交互** | 响应 `/start` 欢迎语，提供使用指引。 |
| **模式切换** | 支持 `/vertical` (垂直拼接)、`/horizontal` (水平拼接) 等模式。 |
| **媒体接收** | 自动下载并暂存用户发送的图片和视频文件。 |
| **智能合并** | 接收 `/end` 指令后，调用算法将暂存的媒体文件合并。 |
| **自动清理** | 发送合并结果后，自动删除临时文件，节省服务器空间。 |

---

## 📋 3. 使用流程 (用户视角)

1.  **开始**: 发送 `/start` 唤醒机器人。
2.  **设置**: (可选) 发送 `/vertical` 或 `/horizontal` 选择拼接方向。
3.  **发送**: 连续发送多张图片或视频。
    *   *机器人回复: "已收到第 x 个文件"*
4.  **合并**: 发送 `/end` 结束发送。
    *   *机器人回复: "正在合并中..." -> 发送最终文件*

---

## ⚠️ 4. 用户需手动配置 (🔴 重要)

在程序运行之前，您**必须**完成以下手动操作：

### 🔹 第一步：获取 Bot Token
1.  在 Telegram 搜索 **@BotFather**。
2.  发送指令 `/newbot`。
3.  按照提示设置机器人名称和用户名。
4.  复制生成的 **API Token**。

### 🔹 第二步：配置项目
1.  打开项目中的 **`config.py`** 文件。
2.  找到 `BOT_TOKEN = "..."` 这一行。
3.  将您刚才复制的 Token 填入引号中。

### 🔹 第三步：安装依赖
1.  确保电脑已安装 **Python**。
2.  确保电脑已安装 **FFmpeg** (用于视频处理)。
3.  在项目文件夹下打开终端，运行：
    ```bash
    pip install -r requirements.txt
    ```

---

## 📂 5. 项目文件结构

```text
telegram_bot/
├── 📄 config.py        [配置] 存放 Token (需手动修改)
├── 📄 main.py          [入口] 机器人的主程序和命令处理
├── 📄 merger.py        [核心] 图片与视频的合并算法逻辑 (待实现)
├── 📄 handlers.py      [扩展] 消息处理器 (预留)
├── 📄 requirements.txt [依赖] Python 库列表
└── 📂 temp/            [缓存] 存放用户上传的临时文件
```

---

## 🛠️ 6. 技术栈
*   **语言**: Python 3.8+
*   **框架**: `python-telegram-bot` (v20+)
*   **图像库**: `Pillow` (PIL)
*   **视频库**: `moviepy`

---

## ☁️ 7. 非本地部署方案 (云端运行)

为了让机器人 24 小时在线，建议将其部署到云端。

### 🌟 方案 A: Koyeb (强烈推荐)
Koyeb 提供真正的免费实例（Nano），支持 Docker，不需要复杂的保活操作。

1.  注册 [Koyeb](https://www.koyeb.com/) 账号。
2.  点击 **Create App** -> 选择 **GitHub** 作为来源。
3.  选择 `telegramhebingbot` 仓库。
4.  **Builder**: 建议选择 **Docker** (因为我们项目中已经包含了 `Dockerfile`)，这样能完美支持 FFmpeg。
5.  点击 **Deploy**。
6.  等待几分钟，当状态变为 **Healthy** 时，机器人即上线。

### 方案 B: Zeabur (备选推荐)
如果 Koyeb 无法注册，Zeabur 是另一个对开发者友好的选择。
1.  注册 [Zeabur](https://zeabur.com/)。
2.  创建项目 -> Deploy New Service -> GitHub。
3.  Zeabur 会自动识别 Dockerfile 并部署。

### 方案 C: Railway (需信用卡/付费)
*注意: Railway 目前对未绑定信用卡的免费账户有限制，可能无法部署 Worker 类应用。*
1.  注册 [Railway](https://railway.app/)。
2.  新建项目 -> Deploy from GitHub。
3.  如有权限，它会自动识别 `nixpacks.toml` 或 `Dockerfile` 进行部署。

### 方案 D: VPS (Linux 服务器)
1.  购买一台 Linux VPS (如 Ubuntu)。
2.  安装 Python 和 FFmpeg:
    ```bash
    sudo apt update
    sudo apt install python3 python3-pip ffmpeg
    ```
3.  上传代码到服务器。
4.  安装依赖:
    ```bash
    pip3 install -r requirements.txt
    ```
5.  使用 `nohup` 或 `systemd` 后台运行:
    ```bash
    nohup python3 main.py > bot.log 2>&1 &
    ```

---

## ✅ 8. 当前开发状态
- [x] **项目框架**: 已搭建。
- [x] **Bot Token**: 已配置。
- [x] **核心功能**: 图片拼接 (Vertical/Horizontal) 已实现。
- [x] **核心功能**: 视频拼接 (Sequential) 已实现。
- [x] **环境依赖**: `requirements.txt` 已生成。
